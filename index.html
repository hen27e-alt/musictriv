<!DOCTYPE html>
<html class="dark" dir="rtl" lang="he">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>MTV Trivia - Leaderboard</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#cd2bee",
                        "background-dark": "#1f1022",
                        "gold": "#FFD700",
                        "silver": "#C0C0C0",
                        "bronze": "#CD7F32",
                    }
                }
            }
        }
    </script>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #1f1022; }
        .synth-grid { background-image: linear-gradient(to bottom, rgba(205, 43, 238, 0.05) 1px, transparent 1px), linear-gradient(to right, rgba(205, 43, 238, 0.05) 1px, transparent 1px); background-size: 40px 40px; }
        .neon-glow-primary { box-shadow: 0 0 15px rgba(205, 43, 238, 0.5); }
        .neon-text-gold { text-shadow: 0 0 8px rgba(255, 215, 0, 0.6); }
    </style>
</head>
<body class="text-white min-h-screen flex flex-col font-display">

<header class="sticky top-0 z-50 bg-background-dark/80 backdrop-blur-md border-b border-primary/20 px-4 py-4 flex items-center justify-between">
    <div class="flex items-center gap-2">
        <span class="material-symbols-outlined text-primary">trophy</span>
        <h1 class="text-xl font-extrabold italic">לוח תוצאות <span class="text-primary">LIVE</span></h1>
    </div>
</header>

<main id="main-content" class="flex-1 overflow-y-auto synth-grid pb-32">
    <div id="podium" class="relative px-4 pt-12 pb-8 flex justify-center items-end gap-2 sm:gap-6">
        </div>

    <div id="leaderboard-list" class="px-4 space-y-3">
        </div>
</main>

<nav class="fixed bottom-6 left-1/2 -translate-x-1/2 w-[90%] max-w-md bg-[#251c27]/95 backdrop-blur-xl border border-white/10 rounded-full px-6 py-3 flex items-center justify-between shadow-2xl z-50">
    <a href="index.html" class="flex flex-col items-center gap-1 text-white/50">
        <span class="material-symbols-outlined">home</span>
        <span class="text-[10px] font-bold uppercase">בית</span>
    </a>
    <div class="flex flex-col items-center gap-1 text-primary relative">
        <div class="absolute -top-10 bg-primary p-3 rounded-full shadow-lg neon-glow-primary">
            <span class="material-symbols-outlined text-white text-3xl" style="font-variation-settings: 'FILL' 1">leaderboard</span>
        </div>
        <span class="mt-6 text-[10px] font-bold uppercase">דירוג</span>
    </div>
    <a href="#" class="flex flex-col items-center gap-1 text-white/50">
        <span class="material-symbols-outlined">account_circle</span>
        <span class="text-[10px] font-bold uppercase">פרופיל</span>
    </a>
</nav>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyBSG7iAfYUCeCTqR3S5LrwmW8YoTjok9hM",
        authDomain: "music-trivia-90e88.firebaseapp.com",
        projectId: "music-trivia-90e88",
        databaseURL: "https://music-trivia-90e88-default-rtdb.europe-west1.firebasedatabase.app/",
        storageBucket: "music-trivia-90e88.firebasestorage.app",
        messagingSenderId: "202068722806",
        appId: "1:202068722806:web:93d9c6dac3695e8048cb57"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // נסה לשלוף את השם השמור מהדפדפן
    const myName = localStorage.getItem('trivia_name') || "";

    db.ref('players').on('value', snap => {
        const playersData = snap.val();
        if(!playersData) return;

        // הפיכה למערך ומיון לפי ניקוד
        const sortedPlayers = Object.keys(playersData)
            .map(name => ({ name, score: playersData[name].score || 0 }))
            .sort((a, b) => b.score - a.score);

        renderPodium(sortedPlayers.slice(0, 3));
        renderList(sortedPlayers.slice(3));
    });

    function renderPodium(top3) {
        const podiumDiv = document.getElementById('podium');
        const colors = ['gold', 'silver', 'bronze'];
        const pData = [
            top3[1] || {name: "מחכה...", score: 0}, // מקום 2
            top3[0] || {name: "מחכה...", score: 0}, // מקום 1
            top3[2] || {name: "מחכה...", score: 0}  // מקום 3
        ];

        podiumDiv.innerHTML = pData.map((p, i) => {
            const isFirst = i === 1;
            const colorClass = isFirst ? 'gold' : (i === 0 ? 'silver' : 'bronze');
            const size = isFirst ? 'w-24 h-24' : 'w-18 h-18';
            const rank = i === 1 ? 1 : (i === 0 ? 2 : 3);
            
            return `
                <div class="flex flex-col items-center gap-3 w-1/3 ${isFirst ? '-translate-y-4' : ''}">
                    <div class="relative">
                        <div class="${size} rounded-full border-4 border-${colorClass} overflow-hidden shadow-lg bg-white/5 flex items-center justify-center">
                            <span class="text-2xl font-black text-white/20">${p.name[0]}</span>
                        </div>
                        <div class="absolute -bottom-2 -right-2 bg-${colorClass} text-background-dark w-7 h-7 rounded-full flex items-center justify-center font-bold text-sm">${rank}</div>
                    </div>
                    <div class="text-center">
                        <p class="font-bold text-sm truncate w-24 text-white">${p.name}</p>
                        <p class="text-xs text-${colorClass} font-bold">${p.score.toLocaleString()} נק'</p>
                    </div>
                </div>
            `;
        }).join('');
    }

    function renderList(others) {
        const listDiv = document.getElementById('leaderboard-list');
        listDiv.innerHTML = others.map((p, i) => {
            const isMe = p.name === myName;
            return `
                <div class="${isMe ? 'bg-primary/20 border-2 border-primary' : 'bg-white/5 border border-white/10'} rounded-2xl p-4 flex items-center gap-4">
                    <span class="text-lg font-bold text-white/40 w-6">${i + 4}</span>
                    <div class="flex-1">
                        <h3 class="font-bold text-white">${p.name} ${isMe ? '<span class="bg-primary text-[10px] px-2 py-0.5 rounded-full uppercase ml-2 text-white">אתה</span>' : ''}</h3>
                    </div>
                    <div class="text-left text-primary font-extrabold">${p.score.toLocaleString()} <span class="text-[10px] block text-white/40 uppercase">נקודות</span></div>
                </div>
            `;
        }).join('');
    }
</script>
</body>
</html>
