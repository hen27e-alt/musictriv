<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Trivia LIVE - 拽专 转</title>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <style>
        :root { --primary: #00f2ff; --secondary: #7000ff; --correct: #00ff88; --wrong: #ff0055; --bg: #050505; }
        body { margin: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; overflow-x: hidden; }
        .container { width: 90%; max-width: 450px; background: rgba(255,255,255,0.05); backdrop-filter: blur(15px); padding: 30px; border-radius: 30px; border: 1px solid rgba(255,255,255,0.1); text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .visualizer { width: 100px; height: 100px; border: 4px solid var(--primary); border-radius: 50%; margin: 0 auto 20px; display: flex; align-items: center; justify-content: center; font-size: 40px; box-shadow: 0 0 20px var(--primary); animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.1); opacity: 0.7; } }
        .btn { background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); color: white; padding: 18px; border-radius: 15px; font-size: 1.1rem; cursor: pointer; transition: 0.3s; width: 100%; margin-bottom: 10px; font-weight: bold; }
        .btn:hover { background: rgba(255,255,255,0.2); border-color: var(--primary); }
        .correct { background: var(--correct) !important; color: black !important; box-shadow: 0 0 20px var(--correct); }
        .wrong { background: var(--wrong) !important; box-shadow: 0 0 20px var(--wrong); }
        #leaderboard { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 15px; margin-bottom: 20px; text-align: right; }
        .player-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.1); }
        input { width: 100%; padding: 15px; border-radius: 12px; border: none; margin-bottom: 20px; background: rgba(255,255,255,0.1); color: white; text-align: center; font-size: 1.2rem; }
        .hidden { display: none; }
    </style>
</head>
<body>

<div class="container" id="setup">
    <h1> 拽专 转 LIVE</h1>
    <p>住 砖  爪专祝 专:</p>
    <input type="text" id="username" placeholder="砖 砖...">
    <button class="btn" style="background: var(--primary); color: black;" onclick="joinGame()">住 砖拽</button>
</div>

<div class="container hidden" id="game">
    <div id="leaderboard"></div>
    <div class="visualizer"></div>
    <h2 id="q-text"> 砖 爪 砖专?</h2>
    <div id="options"></div>
    <div id="status" style="margin-top: 15px; color: var(--primary);"></div>
</div>

<audio id="player" crossorigin="anonymous"></audio>

<script>
    // 专转 Firebase 砖砖转
    const firebaseConfig = {
        apiKey: "AIzaSyBSG7iAfYUCeCTqR3S5LrwmW8YoTjok9hM",
        authDomain: "music-trivia-90e88.firebaseapp.com",
        projectId: "music-trivia-90e88",
        databaseURL: "https://music-trivia-90e88-default-rtdb.europe-west1.firebasedatabase.app/",
        storageBucket: "music-trivia-90e88.firebasestorage.app",
        messagingSenderId: "202068722806",
        appId: "1:202068722806:web:93d9c6dac3695e8048cb57",
        measurementId: "G-FZPJ6VLBMS"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const audio = document.getElementById('player');
    let myName = "";

    const songs = [
        { name: "专 专 - 驻专 ", year: 1982, url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
        { name: " 砖 - 转  转", year: 1984, url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
        { name: "砖 - 专转  拽专", year: 1985, url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
        { name: "  - 注转", year: 1998, url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3" }
    ];

    function joinGame() {
        myName = document.getElementById('username').value;
        if (!myName) return alert(" 住 砖");
        document.getElementById('setup').classList.add('hidden');
        document.getElementById('game').classList.remove('hidden');
        
        db.ref('players/' + myName).set({ score: 0 });
        initMultiplayer();
    }

    function initMultiplayer() {
        //  转 砖 
        db.ref('players').on('value', snap => {
            const data = snap.val();
            let html = "<strong> 转 砖:</strong>";
            for (let p in data) {
                html += `<div class="player-row"><span>${p}</span><span>${data[p].score} 拽'</span></div>`;
            }
            document.getElementById('leaderboard').innerHTML = html;
        });

        //  砖 转 (住专 )
        db.ref('currentQ').on('value', snap => {
            const qIdx = snap.val() || 0;
            loadQuestion(qIdx);
        });
    }

    function loadQuestion(idx) {
        const q = songs[idx];
        const optionsDiv = document.getElementById('options');
        optionsDiv.innerHTML = "";
        document.getElementById('status').innerText = "";
        
        audio.src = q.url;
        audio.play().catch(() => document.getElementById('status').innerText = "抓  驻注转 住");

        const years = [q.year, q.year-3, q.year+5, q.year-2].sort(() => Math.random() - 0.5);
        years.forEach(y => {
            const b = document.createElement('button');
            b.className = 'btn';
            b.innerText = y;
            b.onclick = () => check(y, q.year, b);
            optionsDiv.appendChild(b);
        });
    }

    function check(selected, correct, btn) {
        const allBtns = document.querySelectorAll('.btn');
        allBtns.forEach(b => b.onclick = null);

        if (selected == correct) {
            btn.classList.add('correct');
            db.ref('players/' + myName + '/score').transaction(s => (s || 0) + 10);
            setTimeout(triggerNext, 3000);
        } else {
            btn.classList.add('wrong');
            // 爪 转 转砖 
            allBtns.forEach(b => { if(b.innerText == correct) b.classList.add('correct'); });
            setTimeout(triggerNext, 3000);
        }
    }

    function triggerNext() {
        // 专拽 砖拽  注 转 砖  住住 转
        db.ref('currentQ').transaction(q => (q + 1) % songs.length);
    }

    document.body.onclick = () => audio.play();
</script>
</body>
</html>
