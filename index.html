<!DOCTYPE html>
<html class="dark" dir="rtl" lang="he">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>MTV Trivia LIVE - המשחק</title>
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; min-height: 100dvh; background: #1f1022; }
        .glass-effect { background: rgba(45, 27, 50, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(205, 43, 238, 0.2); }
        .vinyl-glow { box-shadow: 0 0 25px rgba(205, 43, 238, 0.4); }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .animate-spin-slow { animation: spin 8s linear infinite; }
        .correct-ans { background: #00ff88 !important; color: black !important; border-color: #00ff88 !important; box-shadow: 0 0 20px #00ff88; }
        .wrong-ans { background: #ff0055 !important; border-color: #ff0055 !important; }
    </style>
</head>
<body class="text-white flex flex-col overflow-hidden">

<header class="w-full px-6 pt-8 pb-4 relative z-10">
    <div class="flex items-center justify-between mb-6">
        <div class="bg-primary/20 px-3 py-1 rounded-full border border-primary/30">
            <span id="q-count" class="text-white text-sm font-bold">שאלה 1/10</span>
        </div>
        <div class="flex flex-col items-center">
            <span id="player-name" class="text-primary text-xs font-bold uppercase tracking-widest">מחובר</span>
            <span id="score-val" class="text-secondary text-lg font-black">0</span>
        </div>
        <button class="size-10 flex items-center justify-center rounded-full bg-white/10" onclick="toggleAudio()">
            <span id="vol-icon" class="material-symbols-outlined">volume_up</span>
        </button>
    </div>
    <div class="w-full h-2 bg-white/10 rounded-full overflow-hidden">
        <div id="prog-bar" class="h-full bg-primary transition-all duration-500 shadow-[0_0_10px_#cd2bee]" style="width: 10%"></div>
    </div>
</header>

<main class="flex-1 flex flex-col items-center justify-between px-6 py-4 relative z-10">
    <div class="relative size-20 flex items-center justify-center">
        <svg class="absolute inset-0 size-full -rotate-90">
            <circle class="text-white/10" cx="40" cy="40" fill="transparent" r="36" stroke="currentColor" stroke-width="4"></circle>
            <circle id="timer-circle" class="text-primary transition-all duration-1000" cx="40" cy="40" fill="transparent" r="36" stroke="currentColor" stroke-dasharray="226" stroke-dashoffset="0" stroke-width="4"></circle>
        </svg>
        <span id="timer-txt" class="text-2xl font-extrabold">15</span>
    </div>

    <div class="text-center max-w-xs">
        <h1 class="text-3xl font-extrabold leading-tight">באיזו שנה יצא השיר?</h1>
        <p id="song-info" class="text-white/60 mt-2 font-medium">טוען שיר...</p>
    </div>

    <div class="relative group">
        <div class="absolute -inset-4 bg-primary/20 rounded-full blur-2xl opacity-50"></div>
        <div class="relative size-48 md:size-56 rounded-full glass-effect p-2 vinyl-glow animate-spin-slow">
            <div class="size-full rounded-full bg-black relative flex items-center justify-center overflow-hidden">
                <div class="absolute inset-0 opacity-30" style="background: repeating-radial-gradient(circle, transparent, transparent 2px, #333 3px, #333 4px);"></div>
                <div class="size-20 rounded-full bg-primary border-4 border-black/50 overflow-hidden flex items-center justify-center">
                    <span class="material-symbols-outlined text-4xl text-white">music_note</span>
                </div>
            </div>
        </div>
    </div>

    <div id="options-grid" class="w-full grid grid-cols-2 gap-4 pb-10">
        </div>
</main>

<audio id="player" crossorigin="anonymous"></audio>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBSG7iAfYUCeCTqR3S5LrwmW8YoTjok9hM",
        authDomain: "music-trivia-90e88.firebaseapp.com",
        projectId: "music-trivia-90e88",
        databaseURL: "https://music-trivia-90e88-default-rtdb.europe-west1.firebasedatabase.app/",
        storageBucket: "music-trivia-90e88.firebasestorage.app",
        messagingSenderId: "202068722806",
        appId: "1:202068722806:web:93d9c6dac3695e8048cb57"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    const audio = document.getElementById('player');
    let timeLeft = 15;
    let timerInterval;

    const songs = [
        { name: "OutKast - Hey Ya!", year: 2003, url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" },
        { name: "Snap! - Rhythm is a Dancer", year: 1992, url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3" },
        { name: "The Beatles - Let It Be", year: 1970, url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3" },
        { name: "Eminem - Without Me", year: 2002, url: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3" }
    ];

    function startTimer() {
        timeLeft = 15;
        clearInterval(timerInterval);
        timerInterval = setInterval(() => {
            timeLeft--;
            document.getElementById('timer-txt').innerText = timeLeft;
            const offset = 226 - (226 * timeLeft / 15);
            document.getElementById('timer-circle').style.strokeDashoffset = offset;
            if(timeLeft <= 0) {
                clearInterval(timerInterval);
                db.ref('currentQ').transaction(c => (c || 0) + 1);
            }
        }, 1000);
    }

    db.ref('currentQ').on('value', snap => {
        const idx = snap.val() || 0;
        loadQuestion(idx);
    });

    function loadQuestion(idx) {
        const q = songs[idx % songs.length];
        document.getElementById('song-info').innerText = q.name;
        document.getElementById('q-count').innerText = `שאלה ${ (idx % songs.length) + 1 }/10`;
        document.getElementById('prog-bar').style.width = ((idx % songs.length) + 1) * 10 + "%";
        
        const grid = document.getElementById('options-grid');
        grid.innerHTML = "";
        audio.src = q.url;
        audio.play().catch(() => {});

        const years = [q.year, q.year-3, q.year+2, q.year+5].sort(() => Math.random() - 0.5);
        years.forEach(y => {
            const b = document.createElement('button');
            b.className = "flex items-center justify-center py-5 px-4 bg-white/5 border border-white/10 rounded-xl transition-all";
            b.innerHTML = `<span class="text-xl font-bold">${y}</span>`;
            b.onclick = () => {
                clearInterval(timerInterval);
                if(y == q.year) b.classList.add('correct-ans');
                else b.classList.add('wrong-ans');
                setTimeout(() => db.ref('currentQ').transaction(c => (c || 0) + 1), 2000);
            };
            grid.appendChild(b);
        });
        startTimer();
    }

    function toggleAudio() {
        if(audio.muted) { audio.muted = false; document.getElementById('vol-icon').innerText = "volume_up"; }
        else { audio.muted = true; document.getElementById('vol-icon').innerText = "volume_off"; }
    }
    
    document.body.onclick = () => audio.play();
</script>
</body>
</html>
