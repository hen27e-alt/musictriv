<!DOCTYPE html>
<html class="dark" dir="rtl" lang="he">
<head>
    <meta charset="utf-8"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>MTV Trivia - The Shop</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-database-compat.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@800&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1" rel="stylesheet"/>
    <style>
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #0a050b; color: white; }
        .gold-border { border: 2px solid #FFD700; box-shadow: 0 0 15px rgba(255, 215, 0, 0.3); }
        .hidden { display: none !important; }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center p-6">
    <header class="w-full max-w-md flex justify-between items-center mb-10 pt-4">
        <button onclick="window.location.href='index.html'" class="material-symbols-outlined text-white/50">arrow_forward</button>
        <div class="flex items-center gap-2 bg-white/5 px-4 py-2 rounded-full border border-white/10">
            <span id="shop-coins" class="text-yellow-500 font-black text-xl">0</span>
            <span class="material-symbols-outlined text-yellow-500 text-sm" style="font-variation-settings: 'FILL' 1">toll</span>
        </div>
    </header>

    <main class="w-full max-w-md space-y-6">
        <div class="gold-border bg-gradient-to-br from-yellow-500/10 to-black p-6 rounded-3xl relative overflow-hidden">
            <h2 class="text-2xl font-black italic italic text-yellow-500 mb-2">砖转 住 </h2>
            <p class="text-sm opacity-70 mb-6">砖 100 注转  -300  转爪拽!</p>
            <button onclick="startBonus()" class="bg-yellow-500 text-black font-black px-8 py-3 rounded-full active:scale-95 transition-all">专 注砖</button>
        </div>

        <section class="space-y-4">
            <h3 class="text-xs font-bold text-white/40 tracking-[0.2em] uppercase px-2">砖驻专</h3>
            <div class="bg-white/5 p-4 rounded-2xl flex items-center justify-between border border-white/10">
                <div class="flex items-center gap-4">
                    <div class="size-12 rounded-xl bg-[#cd2bee]/20 flex items-center justify-center text-[#cd2bee]">
                        <span class="material-symbols-outlined">hdr_strong</span>
                    </div>
                    <div>
                        <p class="font-bold"> 爪 50/50</p>
                        <p class="text-[10px] opacity-40 italic">住专转 2 转砖转 砖转</p>
                    </div>
                </div>
                <button onclick="buy(200)" class="bg-[#cd2bee] px-4 py-2 rounded-full text-xs font-black">200</button>
            </div>
        </section>
    </main>

    <div id="bonus-screen" class="hidden fixed inset-0 z-[200] bg-black flex flex-col items-center justify-center p-8 text-center">
        <div id="bonus-timer" class="text-6xl font-black text-yellow-500 mb-10">10</div>
        <p id="bonus-song" class="text-2xl font-bold italic italic mb-12">注 砖专 拽住专...</p>
        <div id="bonus-options" class="grid grid-cols-2 gap-4 w-full"></div>
    </div>

    <script>
        const firebaseConfig = { databaseURL: "https://music-trivia-90e88-default-rtdb.europe-west1.firebasedatabase.app/" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();
        const myName = localStorage.getItem('trivia_username') || "";

        db.ref('players/' + myName + '/coins').on('value', snap => {
            document.getElementById('shop-coins').innerText = (snap.val() || 0).toLocaleString();
        });

        async function startBonus() {
            const snap = await db.ref('players/' + myName + '/coins').get();
            const coins = snap.val() || 0;
            if(coins < 100) return alert(", 住专  住祝 专!");

            db.ref('players/' + myName + '/coins').set(coins - 100);
            document.getElementById('bonus-screen').classList.remove('hidden');

            const res = await fetch('https://itunes.apple.com/search?term=classic&limit=50');
            const data = await res.json();
            const q = data.results[Math.floor(Math.random()*50)];
            const year = new Date(q.releaseDate).getFullYear();

            document.getElementById('bonus-song').innerText = q.artistName + " - " + q.trackName;
            const grid = document.getElementById('bonus-options');
            grid.innerHTML = "";
            
            [year, year-5, year+3, year-2].sort(() => Math.random()-0.5).forEach(y => {
                const b = document.createElement('button');
                b.className = "py-6 bg-white/10 rounded-2xl font-black text-xl";
                b.innerText = y;
                b.onclick = () => {
                    if(y == year) {
                        alert("驻砖砖砖! 爪拽转. 拽 300 注转!");
                        db.ref('players/' + myName + '/coins').transaction(c => (c||0) + 300);
                    } else alert("注转! 砖 转 " + year);
                    location.reload();
                };
                grid.appendChild(b);
            });
        }
    </script>
</body>
</html>
